<?php

return array(

    'stack' => [
        'name' => '{{grains['opg_stackname']}}',
        'environment' => '{{pillar['environment']}}',
    ],

    'authentication' => [
        'endpoint' => '{{pillar['endpoints']['auth']}}/v1/authenticate',
    ],

    'log' => [
        'path' => '{{pillar['apps']['opg-lpa-api2']['log-dir']}}/application.log',
        'sentry-uri' => '{{pillar['opg-lpa']['sentry']['api-uri']}}',
    ], // log


    'cron' => [

        'lock' => [

            'dynamodb' => [
                'settings' => [
                    'table_name' => '{{pillar['cronlock']['dynamodb']['table']}}',
                ],
{% if 'key' in pillar['cronlock']['dynamodb'] and 'secret' in pillar['cronlock']['dynamodb'] %}
                'client' => [
                    'credentials' => [
                        'key'    => '{{pillar['cronlock']['dynamodb']['key']}}',
                        'secret' => '{{pillar['cronlock']['dynamodb']['secret']}}',
                    ]
                ],
{% endif %}
            ],

        ], // lock

    ], // cron


    'db' => [

        'mongo' => [

            'default' => [

                'options' => [
                    'password' => '{{pillar['mongodb']['configuration']['databases']['opglpa-api']['owner_password']}}',
                ],

            ],

        ], // mongo

        // Used to access generated PDFs.
        'redis' => [

            'default' => [

                'host' => '{{pillar['pdf']['cache']['redis']['host']}}',

            ],

        ], // redis

        // The queue for PDFs to be generated.
        'resque' => [

            'default' => [

                'host' => '{{pillar['resque']['redis']['host']}}',

            ],

        ], // resque

    ], // db
    
    'log' => [
        'path' => '/var/log/opg-lpa-api2/application.log',
        'sentry-uri' => '{{pillar['opg-lpa']['sentry']['api-uri']}}',
    ], // log

    'pdf' => [

        'encryption' => [
            // Keys MUST be a 32 character ASCII string
            'keys' => [
                'queue'     => '{{pillar['pdf']['encryption']['key']['queue']}}',      // Key for JSON pushed onto the queue
                'document'  => '{{pillar['pdf']['encryption']['key']['document']}}',   // Key for generated PDFs in the file store
            ],
        ],


        'cache' => [
            's3' => [
                'settings' => [
                    'Bucket' => '{{pillar['pdf']['cache']['s3']['bucket']}}',
                ],
{% if 'key' in pillar['pdf']['cache']['s3'] and 'secret' in pillar['pdf']['cache']['s3'] %}
                'client' => [
                    'credentials' => [
                        'key'    => '{{pillar['pdf']['cache']['s3']['key']}}',
                        'secret' => '{{pillar['pdf']['cache']['s3']['secret']}}',
                    ]
                ],
{% endif %}
            ], // S3
        ], // cache


        'DynamoQueue' => [
            'settings' => [
                'table_name' => '{{pillar['pdf']['queue']['dynamodb']['table']}}',
            ],
{% if 'key' in pillar['pdf']['queue']['dynamodb'] and 'secret' in pillar['pdf']['queue']['dynamodb'] %}
            'client' => [
                'credentials' => [
                    'key'    => '{{pillar['pdf']['queue']['dynamodb']['key']}}',
                    'secret' => '{{pillar['pdf']['queue']['dynamodb']['secret']}}',
                ]
            ],
{% endif %}
        ], // DynamoQueue

    ], // pdf

);
